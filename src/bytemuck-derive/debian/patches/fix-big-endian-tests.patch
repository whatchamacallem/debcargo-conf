From 0259f0d40aba0a736fc7faaa6e98fde2e0fa23d7 Mon Sep 17 00:00:00 2001
From: James McCoy <jamessan@jamessan.com>
Date: Sun, 16 Nov 2025 22:56:15 -0500
Subject: [PATCH] Fix CheckedBitPattern derive tests on big-endian
---
 derive/tests/basic.rs | 20 ++++++++++++++++++--
 1 file changed, 18 insertions(+), 2 deletions(-)

diff --git a/derive/tests/basic.rs b/derive/tests/basic.rs
index 72ec028..789acb7 100644
--- a/tests/basic.rs
+++ b/tests/basic.rs
@@ -449,11 +449,16 @@ fn checkedbitpattern_c_default_discriminant_enum_with_fields() {
     CheckedBitPatternCDefaultDiscriminantEnumWithFields::A(0xcc555555555555cc)
   );
 
-  #[cfg(target_pointer_width = "64")]
+  #[cfg(all(target_pointer_width = "64", target_endian = "little"))]
   let pod = [
     0x01, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xcc, 0x55, 0x55, 0x55,
     0x55, 0x55, 0x55, 0xcc,
   ];
+  #[cfg(all(target_pointer_width = "64", target_endian = "big"))]
+  let pod = [
+    0x00, 0x00, 0x00, 0x01, 0x00, 0x00, 0x00, 0x00, 0xcc, 0x55, 0x55, 0x55,
+    0x55, 0x55, 0x55, 0xcc,
+  ];
   #[cfg(target_pointer_width = "32")]
   let pod =
     [0x01, 0x00, 0x00, 0x00, 0xcc, 0x55, 0x55, 0x55, 0x55, 0x55, 0x55, 0xcc];
@@ -546,7 +551,7 @@ fn checkedbitpattern_nested_enum_with_fields() {
   assert_eq!(result, Err(CheckedCastError::InvalidBitPattern));
 
   // next we'll check variant B, nested variant B
-  #[cfg(target_pointer_width = "64")]
+  #[cfg(all(target_pointer_width = "64", target_endian = "little"))]
   let pod = Align8Bytes([
     0x01, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
     0x00, // byte 0 discriminant = 1 = variant B, bytes 1-7 padding
@@ -557,6 +562,17 @@ fn checkedbitpattern_nested_enum_with_fields() {
     0xcc, 0x55, 0x55, 0x55, 0x55, 0x55, 0x55,
     0xcc, // bytes 16-23 is the data contained in nested variant B
   ]);
+  #[cfg(all(target_pointer_width = "64", target_endian = "big"))]
+  let pod = Align8Bytes([
+    0x01, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
+    0x00, // byte 0 discriminant = 1 = variant B, bytes 1-7 padding
+    0x00, 0x00, 0x00, 0x01, 0x00, 0x00, 0x00,
+    0x00, /* bytes 8-15 is C int size discriminant of
+           * CheckedBitPatternCDefaultDiscrimimantEnumWithFields, 1 (LE byte
+           * order) = variant B */
+    0xcc, 0x55, 0x55, 0x55, 0x55, 0x55, 0x55,
+    0xcc, // bytes 16-23 is the data contained in nested variant B
+  ]);
   #[cfg(target_pointer_width = "32")]
   let pod = Align8Bytes([
     0x01, 0x00, 0x00,
