From fe7c07c4f51e9d46cf0a50bc2aaf1d5c595268fb Mon Sep 17 00:00:00 2001
From: Daniel Kahn Gillmor <dkg@fifthhorseman.net>
Date: Wed, 9 Mar 2022 19:02:06 -0500
Subject: [PATCH] Move from parking_lot::Mutex to serial_test

Closes: #34
---
 Cargo.toml   |  2 +-
 src/tests.rs | 14 +++++++-------
 2 files changed, 8 insertions(+), 8 deletions(-)

diff --git a/Cargo.toml b/Cargo.toml
index 04debd5..e0e08c0 100644
--- a/Cargo.toml
+++ b/Cargo.toml
@@ -23,9 +23,8 @@
 repository = "https://github.com/SergioBenitez/yansi"
 
 [dependencies]
-[dev-dependencies.parking_lot]
-version = "0.5"
-features = ["nightly"]
+[dev-dependencies.serial_test]
+version = "*"
 [badges.travis-ci]
 branch = "master"
 repository = "SergioBenitez/yansi"
diff --git a/src/tests.rs b/src/tests.rs
index 50a0127..f869ffe 100644
--- a/src/tests.rs
+++ b/src/tests.rs
@@ -1,15 +1,11 @@
-extern crate parking_lot;
+extern crate serial_test;
+use self::serial_test::serial;
 
 use super::Color::*;
 use super::{Paint, Style};
 
-use self::parking_lot::Mutex;
-
-static LOCK: Mutex<()> = Mutex::new(());
-
 macro_rules! assert_renders {
     ($($input:expr => $expected:expr,)*) => {
-        let _lock = LOCK.lock();
         $(
             let (input, expected) = ($input.to_string(), $expected.to_string());
             if input != expected {
@@ -22,7 +18,6 @@ macro_rules! assert_renders {
 
 macro_rules! assert_disabled_renders {
     ($($input:expr => $expected:expr,)*) => {
-        let _lock = LOCK.lock();
         $(
             Paint::disable();
             let (actual, expected) = ($input.to_string(), $expected.to_string());
@@ -33,6 +28,7 @@ macro_rules! assert_disabled_renders {
 }
 
 #[test]
+#[serial]
 fn colors_enabled() {
     assert_renders! {
         Paint::new("text/plain") => "text/plain",
@@ -70,6 +66,7 @@ fn colors_enabled() {
 }
 
 #[test]
+#[serial]
 fn colors_disabled() {
     assert_disabled_renders! {
         Paint::new("text/plain") => "text/plain",
@@ -109,6 +106,7 @@ fn colors_disabled() {
 }
 
 #[test]
+#[serial]
 fn masked_when_disabled() {
     assert_disabled_renders! {
         Paint::masked("text/plain") => "",
@@ -124,6 +122,7 @@ fn masked_when_disabled() {
 }
 
 #[test]
+#[serial]
 fn masked_when_enabled() {
     assert_renders! {
         Paint::masked("text/plain") => "text/plain",
@@ -141,6 +140,7 @@ fn masked_when_enabled() {
 }
 
 #[test]
+#[serial]
 fn wrapping() {
     let inner = || format!("{} b {}", Paint::red("a"), Paint::green("c"));
     let inner2 = || format!("0 {} 1", Paint::magenta(&inner()).wrap());
-- 
2.34.1

