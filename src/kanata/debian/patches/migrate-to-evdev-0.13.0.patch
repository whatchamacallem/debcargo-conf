From 09bbfb90c879ec73349fc012d79ec00a71056ae6 Mon Sep 17 00:00:00 2001
From: Agathe Porte <989521+gagath@users.noreply.github.com>
Date: Wed, 9 Jul 2025 14:44:42 +0200
Subject: [PATCH] chore: migrate to evdev 0.13.0

---
 Cargo.lock          | 39 ++++++++++-----------
 Cargo.toml          |  2 +-
 src/kanata/linux.rs | 20 +++++------
 src/oskbd/linux.rs  | 82 ++++++++++++++++++++++-----------------------
 src/oskbd/macos.rs  |  2 +-
 5 files changed, 70 insertions(+), 75 deletions(-)

--- a/Cargo.lock
+++ b/Cargo.lock
@@ -45,7 +45,7 @@
 checksum = "df099ccb16cd014ff054ac1bf392c67feeef57164b05c42f037cd40f5d4357f4"
 dependencies = [
  "clipboard-win",
- "core-graphics 0.23.2",
+ "core-graphics",
  "image",
  "log",
  "objc2",
@@ -176,6 +176,12 @@
 checksum = "baf1de4339761588bc0619e3cbc0120ee582ebb74b53b4efbf79117bd2da40fd"
 
 [[package]]
+name = "cfg_aliases"
+version = "0.2.1"
+source = "registry+https://github.com/rust-lang/crates.io-index"
+checksum = "613afe47fcd5fac7ccf1db93babcb082c5994d996f20b8b159f2ad1658eb5724"
+
+[[package]]
 name = "clap"
 version = "4.5.20"
 source = "registry+https://github.com/rust-lang/crates.io-index"
@@ -234,16 +240,6 @@
 ]
 
 [[package]]
-name = "core-foundation"
-version = "0.10.0"
-source = "registry+https://github.com/rust-lang/crates.io-index"
-checksum = "b55271e5c8c478ad3f38ad24ef34923091e0548492a266d19b3c0b4d82574c63"
-dependencies = [
- "core-foundation-sys",
- "libc",
-]
-
-[[package]]
 name = "core-foundation-sys"
 version = "0.8.7"
 source = "registry+https://github.com/rust-lang/crates.io-index"
@@ -256,21 +252,8 @@
 checksum = "c07782be35f9e1140080c6b96f0d44b739e2278479f64e02fdab4e32dfd8b081"
 dependencies = [
  "bitflags 1.3.2",
- "core-foundation 0.9.4",
- "core-graphics-types 0.1.3",
- "foreign-types",
- "libc",
-]
-
-[[package]]
-name = "core-graphics"
-version = "0.24.0"
-source = "registry+https://github.com/rust-lang/crates.io-index"
-checksum = "fa95a34622365fa5bbf40b20b75dba8dfa8c94c734aea8ac9a5ca38af14316f1"
-dependencies = [
- "bitflags 2.6.0",
- "core-foundation 0.10.0",
- "core-graphics-types 0.2.0",
+ "core-foundation",
+ "core-graphics-types",
  "foreign-types",
  "libc",
 ]
@@ -282,18 +265,7 @@
 checksum = "45390e6114f68f718cc7a830514a96f903cccd70d02a8f6d9f643ac4ba45afaf"
 dependencies = [
  "bitflags 1.3.2",
- "core-foundation 0.9.4",
- "libc",
-]
-
-[[package]]
-name = "core-graphics-types"
-version = "0.2.0"
-source = "registry+https://github.com/rust-lang/crates.io-index"
-checksum = "3d44a101f213f6c4cdc1853d4b78aef6db6bdfa3468798cc1d9912f4735013eb"
-dependencies = [
- "bitflags 2.6.0",
- "core-foundation 0.10.0",
+ "core-foundation",
  "libc",
 ]
 
@@ -398,15 +370,14 @@
 
 [[package]]
 name = "evdev"
-version = "0.12.2"
+version = "0.13.1"
 source = "registry+https://github.com/rust-lang/crates.io-index"
-checksum = "ab6055a93a963297befb0f4f6e18f314aec9767a4bbe88b151126df2433610a7"
+checksum = "a3c10865aeab1a7399b3c2d6046e8dcc7f5227b656f235ed63ef5ee45a47b8f8"
 dependencies = [
  "bitvec",
  "cfg-if",
  "libc",
- "nix 0.23.2",
- "thiserror",
+ "nix",
 ]
 
 [[package]]
@@ -559,9 +530,9 @@
 
 [[package]]
 name = "inotify"
-version = "0.10.2"
+version = "0.9.6"
 source = "registry+https://github.com/rust-lang/crates.io-index"
-checksum = "fdd168d97690d0b8c412d6b6c10360277f4d7ee495c5d0d5d5fe0854923255cc"
+checksum = "f8069d3ec154eb856955c1c0fbffefbf5f3c40a104ec912d4797314c1801abff"
 dependencies = [
  "bitflags 1.3.2",
  "inotify-sys",
@@ -578,18 +549,6 @@
 ]
 
 [[package]]
-name = "instant"
-version = "0.1.13"
-source = "registry+https://github.com/rust-lang/crates.io-index"
-checksum = "e0242819d153cba4b4b05a5a8f2a7e9bbf97b6055b2a002b395c96b5ff3c0222"
-dependencies = [
- "cfg-if",
- "js-sys",
- "wasm-bindgen",
- "web-sys",
-]
-
-[[package]]
 name = "interception-sys"
 version = "0.1.3"
 source = "registry+https://github.com/rust-lang/crates.io-index"
@@ -677,14 +636,12 @@
  "anyhow",
  "arboard",
  "clap",
- "core-graphics 0.24.0",
  "dirs",
  "embed-resource",
  "encode_unicode",
  "evdev",
  "indoc",
  "inotify",
- "instant",
  "kanata-interception",
  "kanata-keyberon",
  "kanata-parser",
@@ -692,11 +649,11 @@
  "karabiner-driverkit",
  "libc",
  "log",
- "miette",
+ "miette 7.6.0",
  "mio",
- "muldiv 1.0.1",
+ "muldiv",
  "native-windows-gui",
- "nix 0.26.4",
+ "nix",
  "objc",
  "once_cell",
  "open",
@@ -711,6 +668,7 @@
  "simplelog",
  "strip-ansi-escapes",
  "time",
+ "web-time",
  "winapi",
  "windows-sys 0.52.0",
 ]
@@ -761,7 +719,7 @@
  "itertools",
  "kanata-keyberon",
  "log",
- "miette",
+ "miette 5.10.0",
  "once_cell",
  "parking_lot",
  "patricia_tree",
@@ -798,9 +756,9 @@
 
 [[package]]
 name = "libc"
-version = "0.2.161"
+version = "0.2.174"
 source = "registry+https://github.com/rust-lang/crates.io-index"
-checksum = "8e9489c2807c139ffd9c1794f4af0ebe86a828db53ecdc7fea2111d0fed085d1"
+checksum = "1171693293099992e19cddea4e8b849964e9846f4acee11b3948bcc337be8776"
 
 [[package]]
 name = "libredox"
@@ -819,6 +777,12 @@
 checksum = "d26c52dbd32dccf2d10cac7725f8eae5296885fb5703b261f7d0a0739ec807ab"
 
 [[package]]
+name = "linux-raw-sys"
+version = "0.9.4"
+source = "registry+https://github.com/rust-lang/crates.io-index"
+checksum = "cd945864f07fe9f5371a27ad7b52a172b4b499999f1d97574c9fa68373937e12"
+
+[[package]]
 name = "lock_api"
 version = "0.4.12"
 source = "registry+https://github.com/rust-lang/crates.io-index"
@@ -850,49 +814,61 @@
 checksum = "78ca9ab1a0babb1e7d5695e3530886289c18cf2f87ec19a575a0abdce112e3a3"
 
 [[package]]
-name = "memoffset"
-version = "0.6.5"
+name = "miette"
+version = "5.10.0"
 source = "registry+https://github.com/rust-lang/crates.io-index"
-checksum = "5aa361d4faea93603064a027415f07bd8e1d5c88c9fbf68bf56a285428fd79ce"
+checksum = "59bb584eaeeab6bd0226ccf3509a69d7936d148cf3d036ad350abe35e8c6856e"
 dependencies = [
- "autocfg",
+ "backtrace",
+ "backtrace-ext",
+ "is-terminal",
+ "miette-derive 5.10.0",
+ "once_cell",
+ "owo-colors 3.5.0",
+ "supports-color 2.1.0",
+ "supports-hyperlinks 2.1.0",
+ "supports-unicode 2.1.0",
+ "terminal_size 0.1.17",
+ "textwrap 0.15.2",
+ "thiserror",
+ "unicode-width 0.1.14",
 ]
 
 [[package]]
-name = "memoffset"
-version = "0.7.1"
+name = "miette"
+version = "7.6.0"
 source = "registry+https://github.com/rust-lang/crates.io-index"
-checksum = "5de893c32cde5f383baa4c04c5d6dbdd735cfd4a794b0debdb2bb1b421da5ff4"
+checksum = "5f98efec8807c63c752b5bd61f862c165c115b0a35685bdcfd9238c7aeb592b7"
 dependencies = [
- "autocfg",
+ "backtrace",
+ "backtrace-ext",
+ "cfg-if",
+ "miette-derive 7.6.0",
+ "owo-colors 4.2.2",
+ "supports-color 3.0.2",
+ "supports-hyperlinks 3.1.0",
+ "supports-unicode 3.0.0",
+ "terminal_size 0.4.2",
+ "textwrap 0.16.2",
+ "unicode-width 0.1.14",
 ]
 
 [[package]]
-name = "miette"
+name = "miette-derive"
 version = "5.10.0"
 source = "registry+https://github.com/rust-lang/crates.io-index"
-checksum = "59bb584eaeeab6bd0226ccf3509a69d7936d148cf3d036ad350abe35e8c6856e"
+checksum = "49e7bc1560b95a3c4a25d03de42fe76ca718ab92d1a22a55b9b4cf67b3ae635c"
 dependencies = [
- "backtrace",
- "backtrace-ext",
- "is-terminal",
- "miette-derive",
- "once_cell",
- "owo-colors",
- "supports-color",
- "supports-hyperlinks",
- "supports-unicode",
- "terminal_size",
- "textwrap",
- "thiserror",
- "unicode-width",
+ "proc-macro2",
+ "quote",
+ "syn",
 ]
 
 [[package]]
 name = "miette-derive"
-version = "5.10.0"
+version = "7.6.0"
 source = "registry+https://github.com/rust-lang/crates.io-index"
-checksum = "49e7bc1560b95a3c4a25d03de42fe76ca718ab92d1a22a55b9b4cf67b3ae635c"
+checksum = "db5b29714e950dbb20d5e6f74f9dcec4edbcc1067bb7f8ed198c097b8c1a818b"
 dependencies = [
  "proc-macro2",
  "quote",
@@ -911,24 +887,18 @@
 
 [[package]]
 name = "mio"
-version = "0.8.11"
+version = "1.0.4"
 source = "registry+https://github.com/rust-lang/crates.io-index"
-checksum = "a4a650543ca06a924e8b371db273b2756685faae30f8487da1b56505a8f78b0c"
+checksum = "78bed444cc8a2160f01cbcf811ef18cac863ad68ae8ca62092e8db51d51c761c"
 dependencies = [
  "libc",
  "log",
  "wasi",
- "windows-sys 0.48.0",
+ "windows-sys 0.59.0",
 ]
 
 [[package]]
 name = "muldiv"
-version = "0.2.1"
-source = "registry+https://github.com/rust-lang/crates.io-index"
-checksum = "0419348c027fa7be448d2ae7ea0e4e04c2334c31dc4e74ab29f00a2a7ca69204"
-
-[[package]]
-name = "muldiv"
 version = "1.0.1"
 source = "registry+https://github.com/rust-lang/crates.io-index"
 checksum = "956787520e75e9bd233246045d19f42fb73242759cc57fba9611d940ae96d4b0"
@@ -941,7 +911,6 @@
 dependencies = [
  "bitflags 1.3.2",
  "lazy_static",
- "muldiv 0.2.1",
  "winapi",
  "winapi-build",
 ]
@@ -957,28 +926,14 @@
 
 [[package]]
 name = "nix"
-version = "0.23.2"
+version = "0.29.0"
 source = "registry+https://github.com/rust-lang/crates.io-index"
-checksum = "8f3790c00a0150112de0f4cd161e3d7fc4b2d8a5542ffc35f099a2562aecb35c"
+checksum = "71e2746dc3a24dd78b3cfcb7be93368c6de9963d30f43a6a73998a9cf4b17b46"
 dependencies = [
- "bitflags 1.3.2",
- "cc",
- "cfg-if",
- "libc",
- "memoffset 0.6.5",
-]
-
-[[package]]
-name = "nix"
-version = "0.26.4"
-source = "registry+https://github.com/rust-lang/crates.io-index"
-checksum = "598beaf3cc6fdd9a5dfb1630c2800c7acd31df7aaf0f565796fba2b53ca1af1b"
-dependencies = [
- "bitflags 1.3.2",
+ "bitflags 2.6.0",
  "cfg-if",
+ "cfg_aliases",
  "libc",
- "memoffset 0.7.1",
- "pin-utils",
 ]
 
 [[package]]
@@ -1194,6 +1149,12 @@
 checksum = "c1b04fb49957986fdce4d6ee7a65027d55d4b6d2265e5848bbb507b58ccfdb6f"
 
 [[package]]
+name = "owo-colors"
+version = "4.2.2"
+source = "registry+https://github.com/rust-lang/crates.io-index"
+checksum = "48dd4f4a2c8405440fd0462561f0e5806bd0f77e86f51c761481bdd4018b545e"
+
+[[package]]
 name = "parking_lot"
 version = "0.12.3"
 source = "registry+https://github.com/rust-lang/crates.io-index"
@@ -1232,12 +1193,6 @@
 ]
 
 [[package]]
-name = "pin-utils"
-version = "0.1.0"
-source = "registry+https://github.com/rust-lang/crates.io-index"
-checksum = "8b870d8c151b6f2fb93e84a13146138f05d02ed11c7e7c54f8826aaaf7c9f184"
-
-[[package]]
 name = "png"
 version = "0.17.16"
 source = "registry+https://github.com/rust-lang/crates.io-index"
@@ -1379,7 +1334,20 @@
  "bitflags 2.6.0",
  "errno",
  "libc",
- "linux-raw-sys",
+ "linux-raw-sys 0.4.15",
+ "windows-sys 0.59.0",
+]
+
+[[package]]
+name = "rustix"
+version = "1.0.7"
+source = "registry+https://github.com/rust-lang/crates.io-index"
+checksum = "c71e83d6afe7ff64890ec6b71d6a69bb8a610ab78ce364b3352876bb4c801266"
+dependencies = [
+ "bitflags 2.6.0",
+ "errno",
+ "libc",
+ "linux-raw-sys 0.9.4",
  "windows-sys 0.59.0",
 ]
 
@@ -1543,6 +1511,15 @@
 ]
 
 [[package]]
+name = "supports-color"
+version = "3.0.2"
+source = "registry+https://github.com/rust-lang/crates.io-index"
+checksum = "c64fc7232dd8d2e4ac5ce4ef302b1d81e0b80d055b9d77c7c4f51f6aa4c867d6"
+dependencies = [
+ "is_ci",
+]
+
+[[package]]
 name = "supports-hyperlinks"
 version = "2.1.0"
 source = "registry+https://github.com/rust-lang/crates.io-index"
@@ -1552,6 +1529,12 @@
 ]
 
 [[package]]
+name = "supports-hyperlinks"
+version = "3.1.0"
+source = "registry+https://github.com/rust-lang/crates.io-index"
+checksum = "804f44ed3c63152de6a9f90acbea1a110441de43006ea51bcce8f436196a288b"
+
+[[package]]
 name = "supports-unicode"
 version = "2.1.0"
 source = "registry+https://github.com/rust-lang/crates.io-index"
@@ -1561,10 +1544,16 @@
 ]
 
 [[package]]
+name = "supports-unicode"
+version = "3.0.0"
+source = "registry+https://github.com/rust-lang/crates.io-index"
+checksum = "b7401a30af6cb5818bb64852270bb722533397edcfc7344954a38f420819ece2"
+
+[[package]]
 name = "syn"
-version = "2.0.85"
+version = "2.0.87"
 source = "registry+https://github.com/rust-lang/crates.io-index"
-checksum = "5023162dfcd14ef8f32034d8bcd4cc5ddc61ef7a247c024a33e24e1f24d21b56"
+checksum = "25aa4ce346d03a6dcd68dd8b4010bcb74e54e62c90c573f394c46eae99aba32d"
 dependencies = [
  "proc-macro2",
  "quote",
@@ -1597,6 +1586,16 @@
 ]
 
 [[package]]
+name = "terminal_size"
+version = "0.4.2"
+source = "registry+https://github.com/rust-lang/crates.io-index"
+checksum = "45c6481c4829e4cc63825e62c49186a34538b7b2750b73b266581ffb612fb5ed"
+dependencies = [
+ "rustix 1.0.7",
+ "windows-sys 0.59.0",
+]
+
+[[package]]
 name = "textwrap"
 version = "0.15.2"
 source = "registry+https://github.com/rust-lang/crates.io-index"
@@ -1604,7 +1603,17 @@
 dependencies = [
  "smawk",
  "unicode-linebreak",
- "unicode-width",
+ "unicode-width 0.1.14",
+]
+
+[[package]]
+name = "textwrap"
+version = "0.16.2"
+source = "registry+https://github.com/rust-lang/crates.io-index"
+checksum = "c13547615a44dc9c452a8a534638acdf07120d4b6847c8178705da06306a3057"
+dependencies = [
+ "unicode-linebreak",
+ "unicode-width 0.2.1",
 ]
 
 [[package]]
@@ -1735,6 +1744,12 @@
 checksum = "7dd6e30e90baa6f72411720665d41d89b9a3d039dc45b8faea1ddd07f617f6af"
 
 [[package]]
+name = "unicode-width"
+version = "0.2.1"
+source = "registry+https://github.com/rust-lang/crates.io-index"
+checksum = "4a1a07cc7db3810833284e8d372ccdc6da29741639ecc70c9ec107df0fa6154c"
+
+[[package]]
 name = "utf8parse"
 version = "0.2.2"
 source = "registry+https://github.com/rust-lang/crates.io-index"
@@ -1842,10 +1857,10 @@
 checksum = "65fc09f10666a9f147042251e0dda9c18f166ff7de300607007e96bdebc1068d"
 
 [[package]]
-name = "web-sys"
-version = "0.3.72"
+name = "web-time"
+version = "1.1.0"
 source = "registry+https://github.com/rust-lang/crates.io-index"
-checksum = "f6488b90108c040df0fe62fa815cbdee25124641df01814dd7282749234c6112"
+checksum = "5a6580f308b1fad9207618087a65c04e7a10bc77e02c8e84e9b00dd4b12fa0bb"
 dependencies = [
  "js-sys",
  "wasm-bindgen",
@@ -2086,7 +2101,7 @@
 checksum = "5d91ffca73ee7f68ce055750bf9f6eca0780b8c85eff9bc046a3b0da41755e12"
 dependencies = [
  "gethostname",
- "rustix",
+ "rustix 0.38.44",
  "x11rb-protocol",
 ]
 
--- a/src/kanata/linux.rs
+++ b/src/kanata/linux.rs
@@ -4,7 +4,7 @@
 )]
 
 use anyhow::{anyhow, bail, Result};
-use evdev::{InputEvent, InputEventKind, RelativeAxisType};
+use evdev::{InputEvent, EventSummary, RelativeAxisCode};
 use log::info;
 use parking_lot::Mutex;
 use std::convert::TryFrom;
@@ -46,7 +46,7 @@
 
             for in_event in events.iter().copied() {
                 if let Some(ms_mvmt_key) = *mouse_movement_key.lock() {
-                    if let InputEventKind::RelAxis(_) = in_event.kind() {
+                    if let EventSummary::RelativeAxis(_, _, _) = in_event.destructure() {
                         let fake_event = KeyEvent::new(ms_mvmt_key, KeyValue::Tap);
                         if let Err(e) = tx.try_send(fake_event) {
                             bail!("failed to send on channel: {}", e)
@@ -148,10 +148,10 @@
 ) -> Result<bool> {
     let direction: MWheelDirection = code.try_into().unwrap();
     let scroll_distance = in_event.value().unsigned_abs() as u16;
-    match in_event.kind() {
-        InputEventKind::RelAxis(axis_type) => {
+    match in_event.destructure() {
+        EventSummary::RelativeAxis(_, axis_type, _) => {
             match axis_type {
-                RelativeAxisType::REL_WHEEL | RelativeAxisType::REL_HWHEEL => {
+                RelativeAxisCode::REL_WHEEL | RelativeAxisCode::REL_HWHEEL => {
                     if MAPPED_KEYS.lock().contains(&code) {
                         return Ok(true);
                     }
@@ -168,10 +168,10 @@
                     let mut kanata = kanata.lock();
                     if !all_events.iter().any(|ev| {
                         matches!(
-                            ev.kind(),
-                            InputEventKind::RelAxis(
-                                RelativeAxisType::REL_WHEEL_HI_RES
-                                    | RelativeAxisType::REL_HWHEEL_HI_RES
+                            ev.destructure(),
+                            EventSummary::RelativeAxis(_,
+                                RelativeAxisCode::REL_WHEEL_HI_RES
+                                    | RelativeAxisCode::REL_HWHEEL_HI_RES, _
                             )
                         )
                     }) {
@@ -182,7 +182,7 @@
                     }
                     Ok(false)
                 }
-                RelativeAxisType::REL_WHEEL_HI_RES | RelativeAxisType::REL_HWHEEL_HI_RES => {
+                RelativeAxisCode::REL_WHEEL_HI_RES | RelativeAxisCode::REL_HWHEEL_HI_RES => {
                     if !MAPPED_KEYS.lock().contains(&code) {
                         // Passthrough if the scroll wheel event is not mapped
                         // in the configuration.
--- a/src/oskbd/linux.rs
+++ b/src/oskbd/linux.rs
@@ -3,7 +3,7 @@
 #![cfg_attr(feature = "simulated_output", allow(dead_code, unused_imports))]
 
 pub use evdev::BusType;
-use evdev::{uinput, Device, EventType, InputEvent, Key, PropType, RelativeAxisType};
+use evdev::{uinput, Device, EventType, InputEvent, KeyCode, PropType, RelativeAxisCode};
 use inotify::{Inotify, WatchMask};
 use mio::{unix::SourceFd, Events, Interest, Poll, Token};
 use nix::ioctl_read_buf;
@@ -264,7 +264,7 @@
     let is_keyboard = device.supported_keys().is_some_and(has_keyboard_keys);
     let is_mouse = device
         .supported_relative_axes()
-        .is_some_and(|axes| axes.contains(RelativeAxisType::REL_X));
+        .is_some_and(|axes| axes.contains(RelativeAxisCode::REL_X));
     let device_type = match (is_keyboard, is_mouse) {
         (true, true) => DeviceType::KeyboardMouse,
         (true, false) => DeviceType::Keyboard,
@@ -305,14 +305,14 @@
     }
 }
 
-fn has_keyboard_keys(keys: &evdev::AttributeSetRef<Key>) -> bool {
+fn has_keyboard_keys(keys: &evdev::AttributeSetRef<KeyCode>) -> bool {
     const SENSIBLE_KEYBOARD_SCANCODE_LOWER_BOUND: u16 = 1;
     // The next one is power button. Some keyboards have it,
     // but so does the power button...
     const SENSIBLE_KEYBOARD_SCANCODE_UPPER_BOUND: u16 = 115;
     let mut sensible_keyboard_keys = (SENSIBLE_KEYBOARD_SCANCODE_LOWER_BOUND
         ..=SENSIBLE_KEYBOARD_SCANCODE_UPPER_BOUND)
-        .map(Key::new);
+        .map(KeyCode::new);
     sensible_keyboard_keys.any(|k| keys.contains(k))
 }
 
@@ -320,22 +320,22 @@
     type Error = ();
     fn try_from(item: InputEvent) -> Result<Self, Self::Error> {
         use OsCode::*;
-        match item.kind() {
-            evdev::InputEventKind::Key(k) => Ok(Self {
+        match item.destructure() {
+            evdev::EventSummary::Key(_, k, _) => Ok(Self {
                 code: OsCode::from_u16(k.0).ok_or(())?,
                 value: KeyValue::from(item.value()),
             }),
-            evdev::InputEventKind::RelAxis(axis_type) => {
+            evdev::EventSummary::RelativeAxis(_, axis_type, _) => {
                 let dist = item.value();
                 let code: OsCode = match axis_type {
-                    RelativeAxisType::REL_WHEEL | RelativeAxisType::REL_WHEEL_HI_RES => {
+                    RelativeAxisCode::REL_WHEEL | RelativeAxisCode::REL_WHEEL_HI_RES => {
                         if dist > 0 {
                             MouseWheelUp
                         } else {
                             MouseWheelDown
                         }
                     }
-                    RelativeAxisType::REL_HWHEEL | RelativeAxisType::REL_HWHEEL_HI_RES => {
+                    RelativeAxisCode::REL_HWHEEL | RelativeAxisCode::REL_HWHEEL_HI_RES => {
                         if dist > 0 {
                             MouseWheelRight
                         } else {
@@ -356,7 +356,7 @@
 
 impl From<KeyEvent> for InputEvent {
     fn from(item: KeyEvent) -> Self {
-        InputEvent::new(EventType::KEY, item.code as u16, item.value as i32)
+        InputEvent::new(EventType::KEY.0, item.code as u16, item.value as i32)
     }
 }
 
@@ -384,23 +384,23 @@
         // TODO investigate the rare possibility that a device is e.g. a Joystick and a Keyboard or a Mouse at the same time, which could lead to lost events
 
         // For some reason 0..0x300 (max value for a key) doesn't work, the closest that I've got to work is 560
-        let keys = evdev::AttributeSet::from_iter((0..560).map(evdev::Key));
+        let keys = evdev::AttributeSet::from_iter((0..560).map(evdev::KeyCode));
         let relative_axes = evdev::AttributeSet::from_iter([
-            RelativeAxisType::REL_WHEEL,
-            RelativeAxisType::REL_HWHEEL,
-            RelativeAxisType::REL_X,
-            RelativeAxisType::REL_Y,
-            RelativeAxisType::REL_Z,
-            RelativeAxisType::REL_RX,
-            RelativeAxisType::REL_RY,
-            RelativeAxisType::REL_RZ,
-            RelativeAxisType::REL_DIAL,
-            RelativeAxisType::REL_MISC,
-            RelativeAxisType::REL_WHEEL_HI_RES,
-            RelativeAxisType::REL_HWHEEL_HI_RES,
+            RelativeAxisCode::REL_WHEEL,
+            RelativeAxisCode::REL_HWHEEL,
+            RelativeAxisCode::REL_X,
+            RelativeAxisCode::REL_Y,
+            RelativeAxisCode::REL_Z,
+            RelativeAxisCode::REL_RX,
+            RelativeAxisCode::REL_RY,
+            RelativeAxisCode::REL_RZ,
+            RelativeAxisCode::REL_DIAL,
+            RelativeAxisCode::REL_MISC,
+            RelativeAxisCode::REL_WHEEL_HI_RES,
+            RelativeAxisCode::REL_HWHEEL_HI_RES,
         ]);
 
-        let device = uinput::VirtualDeviceBuilder::new()?
+        let device = uinput::VirtualDevice::builder()?
             .name(&name)
             // libinput's "disable while typing" feature don't work when bus_type
             // is set to BUS_USB, but appears to work when it's set to BUS_I8042.
@@ -496,7 +496,7 @@
     }
 
     pub fn write_code(&mut self, code: u32, value: KeyValue) -> Result<(), io::Error> {
-        let event = InputEvent::new(EventType::KEY, code as u16, value as i32);
+        let event = InputEvent::new(EventType::KEY.0, code as u16, value as i32);
         self.device.emit(&[event])?;
         Ok(())
     }
@@ -584,11 +584,11 @@
         }
 
         let hi_res_scroll_event = InputEvent::new(
-            EventType::RELATIVE,
+            EventType::RELATIVE.0,
             match direction {
-                MWheelDirection::Up | MWheelDirection::Down => RelativeAxisType::REL_WHEEL_HI_RES.0,
+                MWheelDirection::Up | MWheelDirection::Down => RelativeAxisCode::REL_WHEEL_HI_RES.0,
                 MWheelDirection::Left | MWheelDirection::Right => {
-                    RelativeAxisType::REL_HWHEEL_HI_RES.0
+                    RelativeAxisCode::REL_HWHEEL_HI_RES.0
                 }
             },
             match direction {
@@ -601,13 +601,13 @@
             self.write_many(&[
                 hi_res_scroll_event,
                 InputEvent::new(
-                    EventType::RELATIVE,
+                    EventType::RELATIVE.0,
                     match direction {
                         MWheelDirection::Up | MWheelDirection::Down => {
-                            RelativeAxisType::REL_WHEEL.0
+                            RelativeAxisCode::REL_WHEEL.0
                         }
                         MWheelDirection::Left | MWheelDirection::Right => {
-                            RelativeAxisType::REL_HWHEEL.0
+                            RelativeAxisCode::REL_HWHEEL.0
                         }
                     },
                     match direction {
@@ -625,24 +625,24 @@
 
     pub fn move_mouse(&mut self, mv: CalculatedMouseMove) -> Result<(), io::Error> {
         let (axis, distance) = match mv.direction {
-            MoveDirection::Up => (RelativeAxisType::REL_Y, -i32::from(mv.distance)),
-            MoveDirection::Down => (RelativeAxisType::REL_Y, i32::from(mv.distance)),
-            MoveDirection::Left => (RelativeAxisType::REL_X, -i32::from(mv.distance)),
-            MoveDirection::Right => (RelativeAxisType::REL_X, i32::from(mv.distance)),
+            MoveDirection::Up => (RelativeAxisCode::REL_Y, -i32::from(mv.distance)),
+            MoveDirection::Down => (RelativeAxisCode::REL_Y, i32::from(mv.distance)),
+            MoveDirection::Left => (RelativeAxisCode::REL_X, -i32::from(mv.distance)),
+            MoveDirection::Right => (RelativeAxisCode::REL_X, i32::from(mv.distance)),
         };
-        self.write(InputEvent::new(EventType::RELATIVE, axis.0, distance))
+        self.write(InputEvent::new(EventType::RELATIVE.0, axis.0, distance))
     }
 
     pub fn move_mouse_many(&mut self, moves: &[CalculatedMouseMove]) -> Result<(), io::Error> {
         let mut events = vec![];
         for mv in moves {
             let (axis, distance) = match mv.direction {
-                MoveDirection::Up => (RelativeAxisType::REL_Y, -i32::from(mv.distance)),
-                MoveDirection::Down => (RelativeAxisType::REL_Y, i32::from(mv.distance)),
-                MoveDirection::Left => (RelativeAxisType::REL_X, -i32::from(mv.distance)),
-                MoveDirection::Right => (RelativeAxisType::REL_X, i32::from(mv.distance)),
+                MoveDirection::Up => (RelativeAxisCode::REL_Y, -i32::from(mv.distance)),
+                MoveDirection::Down => (RelativeAxisCode::REL_Y, i32::from(mv.distance)),
+                MoveDirection::Left => (RelativeAxisCode::REL_X, -i32::from(mv.distance)),
+                MoveDirection::Right => (RelativeAxisCode::REL_X, i32::from(mv.distance)),
             };
-            events.push(InputEvent::new(EventType::RELATIVE, axis.0, distance));
+            events.push(InputEvent::new(EventType::RELATIVE.0, axis.0, distance));
         }
         self.write_many(&events)
     }
--- a/src/oskbd/macos.rs
+++ b/src/oskbd/macos.rs
@@ -144,7 +144,7 @@
 
         wait_key(&mut event);
 
-        Ok(InputEvent::new(event))
+        Ok(InputEvent::new(event.0))
     }
 }
 
--- a/Cargo.toml
+++ b/Cargo.toml
@@ -136,7 +136,7 @@
 version = "3.4"
 
 [target.'cfg(target_os = "linux")'.dependencies.evdev]
-version = "0.12.2"
+version = "0.13.0"
 
 [target.'cfg(target_os = "linux")'.dependencies.inotify]
 version = "0.10.0"
