This patch is based on the commit described below, taken from
https://github.com/qarmin/czkawkpull/1425/
(which was squash-merged into master)

It was adapted for use in the Debian package by Peter Michael
Green.

commit 96aa63903bac7420ab51ec84330ca787632412cc
Author: Rafa≈Ç Mikrut <mikrutrafal@protonmail.com>
Date:   Mon Dec 23 08:24:21 2024 +0100

    ffmpg

Index: czkawka-core/src/similar_images.rs
===================================================================
--- czkawka-core.orig/src/similar_images.rs
+++ czkawka-core/src/similar_images.rs
@@ -8,6 +8,7 @@ use std::{mem, panic};
 use bk_tree::BKTree;
 use crossbeam_channel::{Receiver, Sender};
 use fun_time::fun_time;
+use hamming_bitwise_fast::hamming_bitwise_fast;
 use humansize::{format_size, BINARY};
 use image::GenericImageView;
 use image_hasher::{FilterType, HashAlg, HasherConfig};
@@ -92,7 +93,7 @@ struct Hamming;
 
 impl bk_tree::Metric<ImHash> for Hamming {
     fn distance(&self, a: &ImHash, b: &ImHash) -> u32 {
-        hamming::distance_fast(a, b).expect("Calculating hamming distance, cannot fail") as u32
+        hamming_bitwise_fast(a, b)
     }
 
     fn threshold_distance(&self, a: &ImHash, b: &ImHash, _threshold: u32) -> Option<u32> {
Index: czkawka-core/src/similar_videos.rs
===================================================================
--- czkawka-core.orig/src/similar_videos.rs
+++ czkawka-core/src/similar_videos.rs
@@ -5,14 +5,12 @@ use std::path::{Path, PathBuf};
 use std::sync::atomic::Ordering;
 
 use crossbeam_channel::{Receiver, Sender};
-use ffmpeg_cmdline_utils::FfmpegErrorKind::FfmpegNotFound;
 use fun_time::fun_time;
 use humansize::{format_size, BINARY};
 use log::debug;
 use rayon::prelude::*;
 use serde::{Deserialize, Serialize};
-use vid_dup_finder_lib::HashCreationErrorKind::DetermineVideo;
-use vid_dup_finder_lib::{NormalizedTolerance, VideoHash};
+use vid_dup_finder_lib::{ffmpeg_builder, VideoHash};
 
 use crate::common::{check_if_stop_received, delete_files_custom, prepare_thread_handler_common, send_info_and_wait_for_ending_all_threads, VIDEO_FILES_EXTENSIONS};
 use crate::common_cache::{extract_loaded_cache, get_similar_videos_cache_file, load_cache_from_file_generalized_by_path, save_cache_to_file_generalized};
@@ -115,7 +113,7 @@ impl SimilarVideos {
 
     #[fun_time(message = "find_similar_videos", level = "info")]
     pub fn find_similar_videos(&mut self, stop_receiver: Option<&Receiver<()>>, progress_sender: Option<&Sender<ProgressData>>) {
-        if !check_if_ffmpeg_is_installed() {
+        if !ffmpeg_cmdline_utils::ffmpeg_and_ffprobe_are_callable() {
             self.common_data.text_messages.errors.push(flc!("core_ffmpeg_not_found"));
             #[cfg(target_os = "windows")]
             self.common_data.text_messages.errors.push(flc!("core_ffmpeg_not_found_windows"));
@@ -221,7 +219,7 @@ impl SimilarVideos {
                 }
                 let mut file_entry = file_entry.1.clone();
 
-                let vhash = match VideoHash::from_path(&file_entry.path) {
+                let vhash = match ffmpeg_builder::VideoHashBuilder::default().hash(file_entry.path.clone()) {
                     Ok(t) => t,
                     Err(e) => {
                         return {
@@ -300,7 +298,12 @@ impl SimilarVideos {
 
     #[fun_time(message = "match_groups_of_videos", level = "debug")]
     fn match_groups_of_videos(&mut self, vector_of_hashes: Vec<VideoHash>, hashmap_with_file_entries: &HashMap<String, VideosEntry>) {
-        let match_group = vid_dup_finder_lib::search(vector_of_hashes, NormalizedTolerance::new(self.get_params().tolerance as f64 / 100.0f64));
+        // Tolerance in library is a value between 0 and 1
+        // Tolerance in this app is a value between 0 and 20
+        // Default tolerance in library is 0.30
+        // We need to allow to set value in range 0 - 0.5
+        let match_group = vid_dup_finder_lib::search(vector_of_hashes, self.get_params().tolerance as f64 / 40.0f64);
+
         let mut collected_similar_videos: Vec<Vec<VideosEntry>> = Default::default();
         for i in match_group {
             let mut temp_vector: Vec<VideosEntry> = Vec::new();
@@ -408,18 +411,6 @@ impl PrintResults for SimilarVideos {
     }
 }
 
-pub fn check_if_ffmpeg_is_installed() -> bool {
-    let vid = "9999czekoczekoczekolada999.txt";
-    if let Err(DetermineVideo {
-        src_path: _a,
-        error: FfmpegNotFound,
-    }) = VideoHash::from_path(vid)
-    {
-        return false;
-    }
-    true
-}
-
 impl SimilarVideos {
     pub fn get_params(&self) -> &SimilarVideosParameters {
         &self.params
Index: czkawka-core/Cargo.toml
===================================================================
--- czkawka-core.orig/Cargo.toml
+++ czkawka-core/Cargo.toml
@@ -58,14 +58,14 @@ version = "0.5"
 version = "2.0"
 
 [dependencies.ffmpeg_cmdline_utils]
-version = "0.1"
+version = "0.3"
 
 [dependencies.fun_time]
 version = "0.3"
 features = ["log"]
 
-[dependencies.hamming]
-version = "0.1"
+[dependencies.hamming-bitwise-fast]
+version = "1"
 
 [dependencies.handsome_logger]
 version = "0.8"
@@ -183,7 +183,7 @@ version = "3.13"
 version = "5.1"
 
 [dependencies.vid_dup_finder_lib]
-version = "0.1"
+version = "0.2"
 
 [dependencies.xxhash-rust]
 version = "0.8"
