From aa3821390fe804ad73bec28180a07c7ac31e0dc8 Mon Sep 17 00:00:00 2001
From: Matthias Vogelgesang <matthias.vogelgesang@gmail.com>
Date: Fri, 17 Feb 2023 22:11:15 +0100
Subject: [PATCH] Bump base64 to 0.21

[FG]
backported

Signed-off-by: Fabian Gr√ºnbichler <f.gruenbichler@proxmox.com>
---
 Cargo.toml               | 2 +-
 src/stream/xml_reader.rs | 4 +++-
 src/stream/xml_writer.rs | 6 ++++--
 3 files changed, 8 insertions(+), 4 deletions(-)

Index: plist/Cargo.toml
===================================================================
--- plist.orig/Cargo.toml
+++ plist/Cargo.toml
@@ -21,7 +21,7 @@ categories = ["config", "encoding", "par
 license = "MIT"
 repository = "https://github.com/ebarnard/rust-plist/"
 [dependencies.base64]
-version = "0.13.0"
+version = "0.21.0"
 
 [dependencies.indexmap]
 version = "1.0.2"
Index: plist/src/stream/xml_reader.rs
===================================================================
--- plist.orig/src/stream/xml_reader.rs
+++ plist/src/stream/xml_reader.rs
@@ -1,4 +1,4 @@
-use base64;
+use base64::{engine::general_purpose::STANDARD as base64_standard, Engine};
 use std::{
     io::{self, Read},
     str::FromStr,
@@ -94,7 +94,8 @@ impl<R: Read> XmlReader<R> {
                             let mut s = self.read_content()?;
                             // Strip whitespace and line endings from input string
                             s.retain(|c| !c.is_ascii_whitespace());
-                            let data = base64::decode(&s)
+                            let data = base64_standard
+                                .decode(&s)
                                 .map_err(|_| self.with_pos(ErrorKind::InvalidDataString))?;
                             return Ok(Some(Event::Data(data.into())));
                         }
Index: plist/src/stream/xml_writer.rs
===================================================================
--- plist.orig/src/stream/xml_writer.rs
+++ plist/src/stream/xml_writer.rs
@@ -1,4 +1,4 @@
-use base64;
+use base64::{engine::general_purpose::STANDARD as base64_standard, Engine};
 use line_wrap;
 use std::{borrow::Cow, io::Write};
 use xml_rs::{
@@ -275,8 +275,9 @@ fn base64_encode_plist(data: &[u8], inde
     output[..line_ending.len()].copy_from_slice(&line_ending);
 
     // Encode `data` as a base 64 string
-    let base64_string_len =
-        base64::encode_config_slice(data, base64::STANDARD, &mut output[line_ending.len()..]);
+    let base64_string_len = base64_standard
+        .encode_slice(data, &mut output[line_ending.len()..])
+        .expect("encoding slice fits base64 buffer");
 
     // Line wrap the base 64 encoded string
     let line_wrap_len = line_wrap::line_wrap(
