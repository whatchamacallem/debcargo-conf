From: kpcyrd <git@rxv.cc>
Date: Sat, 27 Mar 2021 02:13:41 +0100
Subject: Fixes for rust 1.51.0
Origin: upstream, https://github.com/kpcyrd/sniffglue/pull/84/commits/e2244ab2616272faa8ebce18308e146f275250c4
Reviewed-by: Lukas MÃ¤rdian <slyon@ubuntu.com>

Fix autopkgtests by backporting upstream changes to fmt.rs
---
 src/fmt.rs | 20 ++++++++------------
 1 file changed, 8 insertions(+), 12 deletions(-)

diff --git a/src/fmt.rs b/src/fmt.rs
index 3c2edc4..7c1e011 100644
--- a/src/fmt.rs
+++ b/src/fmt.rs
@@ -328,9 +328,8 @@ impl Format {
                     Request(req) => {
                         out.push_str("[dns] req, ");
 
-                        match req.questions.iter()
-                            .map(|x| format!("{:?}", x))
-                            .reduce(|a, b| a + &align(out.len(), &b))
+                        match Reduce::reduce(req.questions.iter()
+                            .map(|x| format!("{:?}", x)), |a, b| a + &align(out.len(), &b))
                         {
                             Some(dns) => out.push_str(&dns),
                             None => out.push_str("[]"),
@@ -339,9 +338,8 @@ impl Format {
                     Response(resp) => {
                         out.push_str("[dns] resp, ");
 
-                        match resp.answers.iter()
-                            .map(|x| format!("{:?}", x))
-                            .reduce(|a, b| a + &align(out.len(), &b))
+                        match Reduce::reduce(resp.answers.iter()
+                            .map(|x| format!("{:?}", x)), |a, b| a + &align(out.len(), &b))
                         {
                             Some(dns) => out.push_str(&dns),
                             None => out.push_str("[]"),
@@ -534,13 +532,12 @@ fn display_macadr_buf(mac: [u8; 6]) -> String {
 
 #[inline]
 fn display_kv_list(list: &[(&str, Option<&str>)]) -> String {
-    list.iter()
+    Reduce::reduce(list.iter()
         .filter_map(|&(key, ref value)| {
             value.as_ref().map(|value| {
                 format!("{}: {:?}", key, value)
             })
-        })
-        .reduce(|a, b| a + ", " + &b)
+        }), |a, b| a + ", " + &b)
         .map(|extra| format!(" ({})", extra))
         .unwrap_or_else(String::new)
 }
@@ -570,11 +567,10 @@ impl<'a> DhcpKvListWriter<'a> {
     }
 
     fn finalize(self) -> String {
-        self.elements.iter()
+        Reduce::reduce(self.elements.iter()
             .map(|&(key, ref value)| {
                 format!("{}: {}", key, value)
-            })
-            .reduce(|a, b| a + ", " + &b)
+            }), |a, b| a + ", " + &b)
             .map(|extra| format!(" ({})", extra))
             .unwrap_or_else(String::new)
     }
